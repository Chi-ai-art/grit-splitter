<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <title>GridSplitter AI (3Ã—3)</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    * { box-sizing: border-box; }
    body {
      margin: 0;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: radial-gradient(circle at top, #18263d 0, #050814 60%);
      color: #f9fafb;
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 24px;
    }
    .shell {
      width: 100%;
      max-width: 960px;
      background: rgba(15, 23, 42, 0.96);
      border-radius: 18px;
      box-shadow: 0 24px 80px rgba(0,0,0,0.6);
      padding: 24px 24px 28px;
      border: 1px solid rgba(148, 163, 184, 0.3);
    }
    header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
      gap: 16px;
      flex-wrap: wrap;
    }
    .title-block h1 {
      font-size: 1.25rem;
      margin: 0;
    }
    .title-block p {
      margin: 4px 0 0;
      font-size: 0.85rem;
      color: #cbd5f5;
    }
    /* â† ã‚†ã‚‹æ‰‹æ›¸ãã£ã½ã„ç™½æŠœããƒ©ãƒ™ãƒ« */
    .badge {
      font-size: 0.8rem;
      padding: 4px 14px;
      border-radius: 999px;
      border: 2px solid #ffffff;
      background: transparent;
      color: #ffffff;
      font-weight: 600;
      letter-spacing: 0.04em;
      text-shadow: 0 1px 3px rgba(0,0,0,0.6);
      box-shadow: 0 0 0 2px rgba(15,23,42,0.9);
    }

    /* ãƒ‰ãƒ©ãƒƒã‚°ï¼†ãƒ‰ãƒ­ãƒƒãƒ—ã®ã€Œæ ã€ã‚’æ¶ˆã™ãƒãƒ¼ã‚¸ãƒ§ãƒ³ */
    .drop-area {
      margin-top: 8px;
      border-radius: 16px;
      border: none; /* â† æ ãªã—ï¼ */
      background: rgba(15, 23, 42, 0.8);
      padding: 32px 16px;
      text-align: center;
      cursor: pointer;
      transition: background 0.15s, transform 0.1s, box-shadow 0.15s;
    }
    .drop-area.dragover {
      background: rgba(15, 23, 42, 0.95);
      transform: translateY(-1px);
      box-shadow: 0 0 0 2px rgba(56, 189, 248, 0.4);
    }
    .drop-area-icon {
      font-size: 32px;
      margin-bottom: 8px;
      opacity: 0.9;
    }
    .drop-area-title {
      font-size: 0.95rem;
      font-weight: 500;
      margin-bottom: 4px;
    }
    .drop-area-sub {
      font-size: 0.78rem;
      color: #9ca3af;
    }
    main {
      margin-top: 20px;
      display: grid;
      grid-template-columns: minmax(0, 1.2fr) minmax(0, 1.2fr);
      gap: 20px;
    }
    @media (max-width: 800px) {
      main {
        grid-template-columns: 1fr;
      }
    }
    .panel {
      background: rgba(15, 23, 42, 0.85);
      border-radius: 14px;
      border: 1px solid rgba(55, 65, 81, 0.7);
      padding: 12px 12px 14px;
    }
    .panel h2 {
      margin: 0 0 8px;
      font-size: 0.9rem;
      font-weight: 600;
      color: #e5e7eb;
    }
    .panel small {
      font-size: 0.75rem;
      color: #9ca3af;
    }
    #tiles {
      margin-top: 10px;
      display: grid;
      grid-template-columns: repeat(3, minmax(0, 1fr));
      gap: 4px;
    }
    .tile {
      background: #020617;
      border-radius: 8px;
      border: 1px solid rgba(31, 41, 55, 0.9);
      padding: 4px;
      display: flex;
      flex-direction: column;
      align-items: stretch;
      justify-content: space-between;
      min-height: 0;
      font-size: 0.7rem;
    }
    .tile-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 4px;
      margin-bottom: 2px;
      color: #9ca3af;
    }
    .tile-header label {
      display: flex;
      align-items: center;
      gap: 4px;
      cursor: pointer;
    }
    .tile-header input[type="checkbox"] {
      accent-color: #38bdf8;
      width: 12px;
      height: 12px;
    }
    .tile img {
      display: block;
      width: 100%;
      height: auto;
      border-radius: 6px;
      margin-bottom: 4px;
    }
    .tile button {
      border: none;
      border-radius: 999px;
      padding: 4px 0;
      font-size: 0.7rem;
      cursor: pointer;
      background: rgba(56, 189, 248, 0.1);
      color: #e0f2fe;
    }
    .tile button:hover {
      background: rgba(56, 189, 248, 0.25);
    }
    .controls {
      display: flex;
      justify-content: flex-end;
      gap: 8px;
      margin-top: 10px;
      flex-wrap: wrap;
    }
    .btn {
      border-radius: 999px;
      border: 1px solid rgba(148, 163, 184, 0.7);
      padding: 5px 10px;
      font-size: 0.75rem;
      background: transparent;
      color: #e5e7eb;
      cursor: pointer;
      white-space: nowrap;
    }
    .btn-primary {
      border-color: #38bdf8;
      background: rgba(56, 189, 248, 0.15);
      color: #e0f2fe;
    }
    .btn:hover {
      background: rgba(148, 163, 184, 0.2);
    }
    .btn-primary:hover {
      background: rgba(56, 189, 248, 0.3);
    }
    footer {
      margin-top: 18px;
      font-size: 0.7rem;
      color: #6b7280;
      display: flex;
      justify-content: space-between;
      gap: 12px;
      flex-wrap: wrap;
    }
    footer span strong {
      color: #e5e7eb;
      font-weight: 500;
    }
  </style>
</head>
<body>
  <div class="shell">
    <header>
      <div class="title-block">
        <h1>GridSplitter AI (3Ã—3)</h1>
        <p>1æšã®ç”»åƒã‚’ã§3Ã—3ï¼ˆ9åˆ†å‰²ï¼‰ã«ã‚«ãƒƒãƒˆã—ã¾ã™ã€‚</p>
      </div>
      <!-- â˜… ã“ã“ãŒã€Œ3Ã—3dayoã€ãƒ©ãƒ™ãƒ« -->
      <div class="badge">3Ã—3dayo</div>
    </header>

    <label class="drop-area" id="dropArea">
      <input id="fileInput" type="file" accept="image/*" style="display:none" />
      <div class="drop-area-icon">ğŸ–¼ï¸</div>
      <div class="drop-area-title">ç”»åƒã‚’ã“ã“ã«ãƒ‰ãƒ©ãƒƒã‚°ï¼†ãƒ‰ãƒ­ãƒƒãƒ—</div>
      <div class="drop-area-sub">ã¾ãŸã¯ã‚¯ãƒªãƒƒã‚¯ã—ã¦1æšã®ç”»åƒã‚’é¸æŠï¼ˆæ­£æ–¹å½¢ã§ãªãã¦ã‚‚OK / 3Ã—3ã«åˆ†å‰²ï¼‰</div>
    </label>

    <main>
      <section class="panel">
        <h2>å…ƒç”»åƒãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼</h2>
        <small>ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã—ãŸç”»åƒãŒè¡¨ç¤ºã•ã‚Œã¾ã™ã€‚</small>
        <div id="originalPreview" style="margin-top:10px; text-align:center; min-height:120px;">
          <span style="font-size:0.78rem; color:#64748b;">ã¾ã ç”»åƒãŒèª­ã¿è¾¼ã¾ã‚Œã¦ã„ã¾ã›ã‚“ã€‚</span>
        </div>
      </section>

      <section class="panel">
        <h2>3Ã—3 ã®åˆ†å‰²çµæœ</h2>
        <small>ãƒã‚§ãƒƒã‚¯ã‚’å¤–ã—ãŸã‚¿ã‚¤ãƒ«ã¯ä¸€æ‹¬ä¿å­˜ã‹ã‚‰é™¤å¤–ã•ã‚Œã¾ã™ã€‚</small>
        <div id="tiles"></div>
        <div class="controls">
          <button class="btn" id="clearBtn">ã‚¯ãƒªã‚¢</button>
          <button class="btn" id="downloadSelectedBtn">é¸æŠã‚¿ã‚¤ãƒ«ã‚’ZIPä¿å­˜</button>
          <button class="btn btn-primary" id="downloadAllBtn">9æšã¾ã¨ã‚ã¦ZIPä¿å­˜</button>
        </div>
      </section>
    </main>

    <footer>
      <span><strong>ä½¿ã„æ–¹ï¼š</strong>ç”»åƒã‚’1æšã‚¢ãƒƒãƒ— â†’ è‡ªå‹•ã§3Ã—3ã«åˆ†å‰² â†’ å€‹åˆ¥ or ZIPã§ä¿å­˜ã§ãã¾ã™ã€‚</span>
      <span>Â© GridSplitter â€“ Browser edition / Built with HTML + JavaScript only.</span>
    </footer>
  </div>

  <!-- ZIPç”Ÿæˆç”¨ãƒ©ã‚¤ãƒ–ãƒ©ãƒª -->
  <script src="https://cdn.jsdelivr.net/npm/jszip@3.10.1/dist/jszip.min.js"></script>

  <script>
    const fileInput = document.getElementById('fileInput');
    const dropArea = document.getElementById('dropArea');
    const tilesEl  = document.getElementById('tiles');
    const originalPreview = document.getElementById('originalPreview');
    const clearBtn = document.getElementById('clearBtn');
    const downloadAllBtn = document.getElementById('downloadAllBtn');
    const downloadSelectedBtn = document.getElementById('downloadSelectedBtn');

    // ã‚¿ã‚¤ãƒ«æƒ…å ±ã‚’ä¿æŒã™ã‚‹é…åˆ—
    let tilesData = [];

    dropArea.addEventListener('click', () => fileInput.click());

    fileInput.addEventListener('change', (e) => {
      if (e.target.files && e.target.files[0]) {
        handleFile(e.target.files[0]);
      }
    });

    ;['dragenter', 'dragover'].forEach(eventName => {
      dropArea.addEventListener(eventName, (e) => {
        e.preventDefault();
        e.stopPropagation();
        dropArea.classList.add('dragover');
      });
    });
    ;['dragleave', 'drop'].forEach(eventName => {
      dropArea.addEventListener(eventName, (e) => {
        e.preventDefault();
        e.stopPropagation();
        dropArea.classList.remove('dragover');
      });
    });
    dropArea.addEventListener('drop', (e) => {
      const file = e.dataTransfer.files[0];
      if (file) handleFile(file);
    });

    clearBtn.addEventListener('click', () => {
      tilesEl.innerHTML = '';
      tilesData = [];
      originalPreview.innerHTML =
        '<span style="font-size:0.78rem; color:#64748b;">ã¾ã ç”»åƒãŒèª­ã¿è¾¼ã¾ã‚Œã¦ã„ã¾ã›ã‚“ã€‚</span>';
      fileInput.value = '';
    });

    function handleFile(file) {
      const reader = new FileReader();
      reader.onload = (e) => {
        const img = new Image();
        img.onload = () => {
          showOriginal(img);
          splitImage(img);
        };
        img.src = e.target.result;
      };
      reader.readAsDataURL(file);
    }

    function showOriginal(img) {
      originalPreview.innerHTML = '';
      const previewImg = document.createElement('img');
      previewImg.src = img.src;
      previewImg.style.maxWidth = '100%';
      previewImg.style.borderRadius = '10px';
      previewImg.style.boxShadow = '0 10px 30px rgba(0,0,0,0.4)';
      originalPreview.appendChild(previewImg);
    }

    function splitImage(img) {
      tilesEl.innerHTML = '';
      tilesData = [];

      const cols = 3;
      const rows = 3;
      const tileWidth  = img.width / cols;
      const tileHeight = img.height / rows;

      for (let y = 0; y < rows; y++) {
        for (let x = 0; x < cols; x++) {
          const canvas = document.createElement('canvas');
          canvas.width  = tileWidth;
          canvas.height = tileHeight;
          const ctx = canvas.getContext('2d');

          ctx.drawImage(
            img,
            x * tileWidth, y * tileHeight,
            tileWidth, tileHeight,
            0, 0,
            tileWidth, tileHeight
          );

          const dataUrl = canvas.toDataURL('image/png');
          const row = y + 1;
          const col = x + 1;

          // é…åˆ—ã«ä¿å­˜ï¼ˆZIPç”¨ï¼‰
          tilesData.push({ row, col, dataUrl });
          const index = tilesData.length - 1;

          const tileDiv = document.createElement('div');
          tileDiv.className = 'tile';

          const header = document.createElement('div');
          header.className = 'tile-header';

          const label = document.createElement('label');
          const checkbox = document.createElement('input');
          checkbox.type = 'checkbox';
          checkbox.className = 'tile-check';
          checkbox.checked = true;
          checkbox.dataset.index = index;

          const txt = document.createElement('span');
          txt.textContent = `(${row}, ${col})`;

          label.appendChild(checkbox);
          label.appendChild(txt);

          const mini = document.createElement('span');
          mini.textContent = 'ä¿å­˜å¯¾è±¡';
          mini.style.fontSize = '0.65rem';

          header.appendChild(label);
          header.appendChild(mini);

          const tileImg = document.createElement('img');
          tileImg.src = dataUrl;

          const btn = document.createElement('button');
          btn.textContent = `ã“ã®ã‚¿ã‚¤ãƒ«ã ã‘ä¿å­˜`;
          btn.addEventListener('click', () => {
            const a = document.createElement('a');
            a.href = dataUrl;
            a.download = `grid_${row}_${col}.png`;
            a.click();
          });

          tileDiv.appendChild(header);
          tileDiv.appendChild(tileImg);
          tileDiv.appendChild(btn);
          tilesEl.appendChild(tileDiv);
        }
      }
    }

    // å…¨ã‚¿ã‚¤ãƒ«ZIPä¿å­˜
    downloadAllBtn.addEventListener('click', () => {
      if (!tilesData.length) {
        alert('ã¾ãšç”»åƒã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã—ã¦ãã ã•ã„ã€‚');
        return;
      }
      const indices = tilesData.map((_, i) => i);
      downloadZip(indices, 'grid_all.zip');
    });

    // ãƒã‚§ãƒƒã‚¯æ¸ˆã¿ã‚¿ã‚¤ãƒ«ã®ã¿ZIPä¿å­˜
    downloadSelectedBtn.addEventListener('click', () => {
      if (!tilesData.length) {
        alert('ã¾ãšç”»åƒã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã—ã¦ãã ã•ã„ã€‚');
        return;
      }
      const checks = document.querySelectorAll('.tile-check');
      const indices = [];
      checks.forEach(ch => {
        if (ch.checked) {
          indices.push(Number(ch.dataset.index));
        }
      });
      if (!indices.length) {
        alert('ZIPã«å«ã‚ã‚‹ã‚¿ã‚¤ãƒ«ã«ãƒã‚§ãƒƒã‚¯ã‚’å…¥ã‚Œã¦ãã ã•ã„ã€‚');
        return;
      }
      downloadZip(indices, 'grid_selected.zip');
    });

    async function downloadZip(indices, filename) {
      if (!window.JSZip) {
        alert('ZIPãƒ©ã‚¤ãƒ–ãƒ©ãƒªã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸã€‚ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯æ¥ç¶šã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚');
        return;
      }
      const zip = new JSZip();
      indices.forEach(i => {
        const t = tilesData[i];
        const base64 = t.dataUrl.split(',')[1]; // dataURLã‹ã‚‰Base64éƒ¨åˆ†ã ã‘æŠœãå‡ºã—
        zip.file(`grid_${t.row}_${t.col}.png`, base64, { base64: true });
      });

      const blob = await zip.generateAsync({ type: 'blob' });
      const a = document.createElement('a');
      a.href = URL.createObjectURL(blob);
      a.download = filename;
      a.click();
      URL.revokeObjectURL(a.href);
    }
  </script>
</body>
</html>
